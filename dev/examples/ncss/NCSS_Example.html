

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Basic NCSS &mdash; Siphon 0.6.0+15.gfd9dbcc documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://unidata.github.io/siphon/latest/examples/ncss/NCSS_Example.html"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/theme_override.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Siphon 0.6.0+15.gfd9dbcc documentation" href="../../index.html"/>
        <link rel="up" title="Siphon Examples" href="../index.html"/>
        <link rel="next" title="NCSS and CartoPy" href="NCSS_Cartopy_Example.html"/>
        <link rel="prev" title="NCSS Time Series" href="NCSS_Timeseries_Examples.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Siphon
          

          
          </a>

          
            
            
              <div class="version">
                0.6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installguide.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">The Siphon API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Siphon Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#general-examples">General Examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#ncss">NCSS</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="NCSS_Timeseries_Examples.html">NCSS Time Series</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Basic NCSS</a></li>
<li class="toctree-l3"><a class="reference internal" href="NCSS_Cartopy_Example.html">NCSS and CartoPy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#upper-air">Upper Air</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developerguide.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citing.html">Citing Siphon</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Siphon</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Siphon Examples</a> &raquo;</li>
        
      <li>Basic NCSS</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/examples/ncss/NCSS_Example.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="basic-ncss">
<span id="sphx-glr-examples-ncss-ncss-example-py"></span><h1>Basic NCSS<a class="headerlink" href="#basic-ncss" title="Permalink to this headline">¶</a></h1>
<p>Use Siphon to query the NetCDF Subset Service (NCSS).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">siphon.catalog</span> <span class="kn">import</span> <a href="../../api/catalog.html#siphon.catalog.TDSCatalog" title="View documentation for siphon.catalog.TDSCatalog"><span class="n">TDSCatalog</span></a>
</pre></div>
</div>
<p>First we construct a TDSCatalog instance pointing to our dataset of interest, in
this case TDS’ “Best” virtual dataset for the GFS global 0.5 degree collection of
GRIB files. We see this catalog contains a single dataset.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">best_gfs</span> <span class="o">=</span> <a href="../../api/catalog.html#siphon.catalog.TDSCatalog" title="View documentation for siphon.catalog.TDSCatalog"><span class="n">TDSCatalog</span></a><span class="p">(</span><span class="s1">&#39;http://thredds.ucar.edu/thredds/catalog/grib/NCEP/GFS/&#39;</span>
                      <span class="s1">&#39;Global_0p5deg/catalog.xml?dataset=grib/NCEP/GFS/Global_0p5deg/Best&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">best_gfs</span><span class="o">.</span><span class="n">datasets</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;Best GFS Half Degree Forecast Time Series&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>We pull out this dataset and get the NCSS access point</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">best_ds</span> <span class="o">=</span> <span class="n">best_gfs</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ncss</span> <span class="o">=</span> <span class="n">best_ds</span><span class="o">.</span><span class="n">subset</span><span class="p">()</span>
</pre></div>
</div>
<p>We can then use the <cite>ncss</cite> object to create a new query object, which
facilitates asking for data from the server.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">ncss</span><span class="o">.</span><span class="n">query</span><span class="p">()</span>
</pre></div>
</div>
<p>We construct a query asking for data corresponding to latitude 40N and longitude 105W,
for the current time. We also ask for NetCDF version 4 data, for the variables
‘Temperature_isobaric’ and ‘Relative_humidity_isobaric’. This request will return all
vertical levels for a single point and single time. Note the string representation of
the query is a properly encoded query string.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span><span class="o">.</span><span class="n">lonlat_point</span><span class="p">(</span><span class="o">-</span><span class="mi">105</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span>
<span class="n">query</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="s1">&#39;netcdf4&#39;</span><span class="p">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">variables</span><span class="p">(</span><span class="s1">&#39;Temperature_isobaric&#39;</span><span class="p">,</span> <span class="s1">&#39;Relative_humidity_isobaric&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We now request data from the server using this query. The <cite>NCSS</cite> class handles parsing
this NetCDF data (using the <cite>netCDF4</cite> module). If we print out the variable names,
we see our requested variables, as well as a few others (more metadata information)</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">ncss</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
<p>We’ll pull out the variables we want to use, as well as the pressure values. To get the
name of the correct variable for pressure (which matches the levels for temperature and
relative humidity, we look at the <cite>coordinates</cite> attribute. The last of the variables
listed in <cite>coordinates</cite> is the pressure dimension.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Temperature_isobaric&#39;</span><span class="p">]</span>
<span class="n">relh</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Relative_humidity_isobaric&#39;</span><span class="p">]</span>
<span class="n">press_name</span> <span class="o">=</span> <span class="n">relh</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">press</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">press_name</span><span class="p">]</span>
<span class="n">press_vals</span> <span class="o">=</span> <span class="n">press</span><span class="p">[:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we can plot these up using matplotlib.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="View documentation for matplotlib.pyplot.subplots"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">temp</span><span class="p">[:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">press_vals</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;{} ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">standard_name</span><span class="p">,</span> <span class="n">temp</span><span class="o">.</span><span class="n">units</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;{} ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">press</span><span class="o">.</span><span class="n">standard_name</span><span class="p">,</span> <span class="n">press</span><span class="o">.</span><span class="n">units</span><span class="p">))</span>

<span class="c1"># Create second plot with shared y-axis</span>
<span class="n">ax2</span> <span class="o">=</span> <a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.twiny.html#matplotlib.pyplot.twiny" title="View documentation for matplotlib.pyplot.twiny"><span class="n">plt</span><span class="o">.</span><span class="n">twiny</span></a><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">relh</span><span class="p">[:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">press_vals</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;{} ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">relh</span><span class="o">.</span><span class="n">standard_name</span><span class="p">,</span> <span class="n">relh</span><span class="o">.</span><span class="n">units</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">press_vals</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">press_vals</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_NCSS_Example_001.png" class="align-center" src="../../_images/sphx_glr_NCSS_Example_001.png" />
<p><strong>Total running time of the script:</strong> ( 0 minutes  2.583 seconds)</p>
<div class="sphx-glr-footer docutils container">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/NCSS_Example.py" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">NCSS_Example.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/NCSS_Example.ipynb" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">NCSS_Example.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="NCSS_Cartopy_Example.html" class="btn btn-neutral float-right" title="NCSS and CartoPy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="NCSS_Timeseries_Examples.html" class="btn btn-neutral" title="NCSS Time Series" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Unidata.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92978945-1', 'auto');
  ga('send', 'pageview');

</script>
<p>Do you enjoy using Siphon?
  <a href="https://saythanks.io/to/unidata" class="btn btn-neutral" title="Installation Guide" accesskey="n">Say Thanks!</a>
</p>
     


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.6.0+15.gfd9dbcc',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>